<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="java,spring" />
       
      <meta name="description" content="赢在格局，输在计较" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>Java |  fordreams1314个人博客</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?awwssw1snsnsnn1ndndnndnd99j";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


      <!-- mermaid -->
      
    <link rel="alternate" href="/atom.xml" title="fordreams1314个人博客" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-java/Java"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Java
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/05/28/java/Java/" class="article-date">
  <time datetime="2021-05-28T11:24:06.000Z" itemprop="datePublished">2021-05-28</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a> / <a class="article-category-link" href="/categories/java/jvm/">jvm</a> / <a class="article-category-link" href="/categories/java/jvm/juc/">juc</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">3.1k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">15 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-IO和NIO"><a href="#1-IO和NIO" class="headerlink" title="1. IO和NIO"></a>1. IO和NIO</h2><h2 id="2-多线程"><a href="#2-多线程" class="headerlink" title="2. 多线程"></a>2. 多线程</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/renhui/p/6066852.html">Java Thread 的使用</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/a158123/article/details/78633772">Thread的join()方法</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/haolb123/p/14323815.html">Java终止线程的三种方式</a></p>
</blockquote>
<p><img src="/2021/05/28/java/Java/624959-66b49045b1bd7cd6.webp" alt="线程状态图"></p>
<h3 id="2-1-创建线程"><a href="#2-1-创建线程" class="headerlink" title="2.1. 创建线程"></a>2.1. 创建线程</h3><h4 id="2-1-1-实现Runnable接口"><a href="#2-1-1-实现Runnable接口" class="headerlink" title="2.1.1. 实现Runnable接口"></a>2.1.1. 实现Runnable接口</h4><blockquote>
<p>推进使用：方便同一个对象被多个线程使用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(Runnable 实现).start()</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-继承Thread"><a href="#2-1-2-继承Thread" class="headerlink" title="2.1.2. 继承Thread"></a>2.1.2. 继承Thread</h4><h4 id="2-1-3-实现Callable接口"><a href="#2-1-3-实现Callable接口" class="headerlink" title="2.1.3. 实现Callable接口"></a>2.1.3. 实现Callable接口</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">实现Callable接口，需要返回值类型</span><br><span class="line">重写call方法，需要抛出异常</span><br><span class="line">创建目标对象</span><br><span class="line">创建执行服务：ExecutorService ser = Executors.newFixedThreadPool(1);</span><br><span class="line">提交执行：Future&lt;Boolean&gt; result1 = ser.submit(t1);</span><br><span class="line">获取结果：boolean r1 = result1.get()</span><br><span class="line">关闭服务：ser.shutdownNow()</span><br></pre></td></tr></table></figure>

<h3 id="2-2-停止线程"><a href="#2-2-停止线程" class="headerlink" title="2.2. 停止线程"></a>2.2. 停止线程</h3><h4 id="2-2-1-设置一个标志位"><a href="#2-2-1-设置一个标志位" class="headerlink" title="2.2.1. 设置一个标志位"></a>2.2.1. 设置一个标志位</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publ</span><br></pre></td></tr></table></figure>

<h3 id="2-3-礼让线程"><a href="#2-3-礼让线程" class="headerlink" title="2.3. 礼让线程"></a>2.3. 礼让线程</h3><blockquote>
<p>yield()</p>
</blockquote>
<ul>
<li>礼让线程，让当前正在执行的线程暂停，但不阻塞</li>
<li>将线程从运行状态转为就绪状态</li>
<li>让cpu重新调度，礼让不一定成功！看cpu心情</li>
</ul>
<h3 id="2-4-强制执行线程"><a href="#2-4-强制执行线程" class="headerlink" title="2.4. 强制执行线程"></a>2.4. 强制执行线程</h3><blockquote>
<p>join()</p>
</blockquote>
<h3 id="2-5-线程优先级"><a href="#2-5-线程优先级" class="headerlink" title="2.5. 线程优先级"></a>2.5. 线程优先级</h3><blockquote>
<p>priority(1-10)</p>
</blockquote>
<ul>
<li>先设置优先级，再start()</li>
</ul>
<h3 id="2-6-守护线程"><a href="#2-6-守护线程" class="headerlink" title="2.6. 守护线程"></a>2.6. 守护线程</h3><h3 id="2-7-线程同步"><a href="#2-7-线程同步" class="headerlink" title="2.7. 线程同步"></a>2.7. 线程同步</h3><ul>
<li><p>队列+锁</p>
</li>
<li><p>synchronized </p>
</li>
<li><p>lock</p>
</li>
</ul>
<h3 id="2-8-线程通信"><a href="#2-8-线程通信" class="headerlink" title="2.8. 线程通信"></a>2.8. 线程通信</h3><ul>
<li><p>生产者和消费者问题</p>
</li>
<li><p>synchronized </p>
</li>
<li><p>while 防止虚假唤醒</p>
</li>
<li><p>wait()、notifyall()</p>
</li>
</ul>
<h4 id="2-8-1-管程法"><a href="#2-8-1-管程法" class="headerlink" title="2.8.1. 管程法"></a>2.8.1. 管程法</h4><ul>
<li>缓冲池</li>
</ul>
<h4 id="2-8-2-信号灯法"><a href="#2-8-2-信号灯法" class="headerlink" title="2.8.2. 信号灯法"></a>2.8.2. 信号灯法</h4><ul>
<li>标志位</li>
</ul>
<h3 id="2-9-线程池"><a href="#2-9-线程池" class="headerlink" title="2.9. 线程池"></a>2.9. 线程池</h3><h2 id="3-注解和反射"><a href="#3-注解和反射" class="headerlink" title="3. 注解和反射"></a>3. 注解和反射</h2><h2 id="4-JUC"><a href="#4-JUC" class="headerlink" title="4. JUC"></a>4. JUC</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.processon.com/view/5ff905961e0853437c6d010c?fromnew=1#map">参考资料1</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.processon.com/view/60595e325653bb2225dee274?fromnew=1#map">参考资料2</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3c5d7f09dfbd">ThreadLocal</a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/fsmly/p/11020641.html">Java中的ThreadLocal详解</a> <a target="_blank" rel="noopener" href="https://www.freesion.com/article/85951314530/">多个 THREADLOCAL 在 THREAD 中的 THREADLOCALS 里是怎么存储的</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/byhook/article/details/87971081">Java并发编程之happens-before和as-if-serial语义</a></p>
<p><a target="_blank" rel="noopener" href="https://www.topjava.cn/article/1391297837127569408">java并发</a></p>
</blockquote>
<p><img src="/2021/05/28/java/Java/sike-juc.png" alt="sike-juc"></p>
<h3 id="4-1-wait和sleep的区别"><a href="#4-1-wait和sleep的区别" class="headerlink" title="4.1. wait和sleep的区别"></a>4.1. wait和sleep的区别</h3><ul>
<li>来自不同的类</li>
</ul>
<p>wait =&gt; object    sleep =&gt; Thread</p>
<ul>
<li>锁的释放</li>
</ul>
<p>wait 会释放锁，sleep 不会释放</p>
<ul>
<li>使用范围</li>
</ul>
<p>wait 在 synchronized 中使用</p>
<h3 id="4-2-Lock锁"><a href="#4-2-Lock锁" class="headerlink" title="4.2. Lock锁"></a>4.2. Lock锁</h3><h4 id="4-2-1-ReentrantLock"><a href="#4-2-1-ReentrantLock" class="headerlink" title="4.2.1. ReentrantLock"></a>4.2.1. ReentrantLock</h4><ul>
<li>默认非公平锁</li>
<li>必须成对出现</li>
<li>示例：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReentrantLockTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Mycache mycache = <span class="keyword">new</span> Mycache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; j++)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        mycache.put(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+j,<span class="string">&quot;toy&quot;</span>+j);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="string">&quot;thread&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; j++)&#123;</span><br><span class="line">                    mycache.get(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="string">&quot;thread&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Mycache</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key,String value)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+<span class="string">&quot;开始写入&quot;</span>);</span><br><span class="line">            map.put(key,value);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+<span class="string">&quot;退出写入&quot;</span>);</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+<span class="string">&quot;开始读取&quot;</span>);</span><br><span class="line">            String value = map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+<span class="string">&quot;退出读取&quot;</span>);</span><br><span class="line">            lock.unlock();</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">thread0:开始写入</span><br><span class="line">thread0:退出写入</span><br><span class="line">thread1:开始写入</span><br><span class="line">thread1:退出写入</span><br><span class="line">thread1:开始写入</span><br><span class="line">thread1:退出写入</span><br><span class="line">thread2:开始写入</span><br><span class="line">thread2:退出写入</span><br><span class="line">thread0:开始读取</span><br><span class="line">thread0:toy0</span><br><span class="line">thread0:退出读取</span><br><span class="line">thread0:开始读取</span><br><span class="line">thread0:null</span><br><span class="line">thread0:退出读取</span><br><span class="line">thread1:开始读取</span><br><span class="line">thread1:toy0</span><br><span class="line">thread1:退出读取</span><br><span class="line">thread1:开始读取</span><br><span class="line">thread1:toy1</span><br><span class="line">thread1:退出读取</span><br><span class="line">thread2:开始读取</span><br><span class="line">thread2:toy0</span><br><span class="line">thread2:退出读取</span><br><span class="line">thread2:开始读取</span><br><span class="line">thread2:null</span><br><span class="line">thread2:退出读取</span><br><span class="line">thread0:开始写入</span><br><span class="line">thread0:退出写入</span><br><span class="line">thread2:开始写入</span><br><span class="line">thread2:退出写入</span><br></pre></td></tr></table></figure>



<h4 id="4-2-2-synchronized-和-lock-的区别"><a href="#4-2-2-synchronized-和-lock-的区别" class="headerlink" title="4.2.2. synchronized 和 lock 的区别"></a>4.2.2. synchronized 和 lock 的区别</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.topjava.cn/article/1391297775492272128">深入分析synchronized的实现原理</a></p>
<p><a target="_blank" rel="noopener" href="https://my.oschina.net/hosee/blog/2878328">JAVA锁的膨胀过程</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>序号</th>
<th>synchronized</th>
<th>lock</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>内置的java关键字</td>
<td>java接口</td>
</tr>
<tr>
<td>2</td>
<td>无法获取锁的状态</td>
<td>可以获取锁的状态</td>
</tr>
<tr>
<td>3</td>
<td>会自动释放锁</td>
<td>手动释放锁</td>
</tr>
<tr>
<td>4</td>
<td>线程阻塞时，其它线程会一直等待</td>
<td>可以主动尝试获取锁</td>
</tr>
<tr>
<td>5</td>
<td>非公平锁，不可以中断</td>
<td>可以自定义</td>
</tr>
<tr>
<td>6</td>
<td>适合锁少量的同步代码</td>
<td>适合锁大量的同步代码</td>
</tr>
</tbody></table>
<h4 id="4-2-3-Condition"><a href="#4-2-3-Condition" class="headerlink" title="4.2.3. Condition"></a>4.2.3. Condition</h4><blockquote>
<p>await() 、signal()</p>
</blockquote>
<h4 id="4-2-4-八锁现象"><a href="#4-2-4-八锁现象" class="headerlink" title="4.2.4. 八锁现象"></a>4.2.4. 八锁现象</h4><p>synchronized 锁的对象</p>
<p><img src="/2021/05/28/java/Java/image-20210718002843921.png" alt="image-20210718002843921"></p>
<p><img src="/2021/05/28/java/Java/2bcc8161c52eb100d2c7c4c96c70d3c5823.jpg" alt="2bcc8161c52eb100d2c7c4c96c70d3c5823.jpg"></p>
<ul>
<li>方法的调用者</li>
<li>class类模板（static）</li>
</ul>
<h3 id="4-3-集合相关"><a href="#4-3-集合相关" class="headerlink" title="4.3. 集合相关"></a>4.3. 集合相关</h3><p><img src="/2021/05/28/java/Java/image-20210720010303960.png" alt="image-20210720010303960"></p>
<h4 id="4-3-1-ArrayList"><a href="#4-3-1-ArrayList" class="headerlink" title="4.3.1. ArrayList"></a>4.3.1. ArrayList</h4><p>并发下 ArrayList 会抛出 ConcurrentModificationExecptin ，解决办法：</p>
<ol>
<li>new Vector()</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vector.class</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    insertElementAt(element, index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">insertElementAt</span><span class="params">(E obj, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">if</span> (index &gt; elementCount) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException(index</span><br><span class="line">                                                 + <span class="string">&quot; &gt; &quot;</span> + elementCount);</span><br><span class="line">    &#125;</span><br><span class="line">    ensureCapacityHelper(elementCount + <span class="number">1</span>);</span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>, elementCount - index);</span><br><span class="line">    elementData[index] = obj;</span><br><span class="line">    elementCount++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>Collections.synchronizedList(new ArrayList())</p>
</li>
<li><p>new CopyOnWriteArrayList&lt;&gt;() 读写分离</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CopyOnWriteArrayList.class</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="keyword">int</span> len = elements.length;</span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-3-2-HashSet"><a href="#4-3-2-HashSet" class="headerlink" title="4.3.2.  HashSet"></a>4.3.2.  HashSet</h4><ul>
<li>底层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HashSet.class</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object PRESENT = <span class="keyword">new</span> Object();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>并发下 HashSet 会抛出 ConcurrentModificationExecptin ，解决办法：</li>
</ul>
<ol>
<li> Collections.synchronizedSet(new HashSet ())</li>
<li> new CopyOnWriteArraySet()</li>
</ol>
<h4 id="4-3-3-HashMap"><a href="#4-3-3-HashMap" class="headerlink" title="4.3.3. HashMap"></a>4.3.3. HashMap</h4><p>并发下 HashMap 会抛出 ConcurrentModificationExecptin ，解决办法：</p>
<ol>
<li> Collections.synchronizedMap(new HashMap ())</li>
<li> new  ConcurrentHashMap()</li>
</ol>
<h3 id="4-4-Callable"><a href="#4-4-Callable" class="headerlink" title="4.4. Callable"></a>4.4. Callable</h3><ul>
<li>调用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> FutureTask(<span class="keyword">new</span> Callable() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)).start();</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/28/java/Java/image-20210604103451519.png" alt="image-20210604103451519"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        FutureTask task =  <span class="keyword">new</span> FutureTask(<span class="keyword">new</span> Callable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(Thread.currentThread().getName().equals(<span class="string">&quot;A1&quot;</span>))&#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> Thread.currentThread().getName() +<span class="string">&quot; do working&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">new</span> Thread(task,<span class="string">&quot;A1&quot;</span>).start();</span><br><span class="line">        <span class="comment">// task.get 会阻塞线程</span></span><br><span class="line">        String status = (String) task.get();</span><br><span class="line">        System.out.println(status);</span><br><span class="line">        <span class="comment">// call 只会被执行一次</span></span><br><span class="line">        <span class="keyword">new</span> Thread(task,<span class="string">&quot;A2&quot;</span>).start();</span><br><span class="line">        status = (String) task.get();</span><br><span class="line">        System.out.println(status);</span><br><span class="line"></span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A1 do working</span><br><span class="line">A1 do working</span><br><span class="line">main</span><br></pre></td></tr></table></figure>

<h3 id="4-5-CountDownLatch（倒计时弹簧锁）"><a href="#4-5-CountDownLatch（倒计时弹簧锁）" class="headerlink" title="4.5. CountDownLatch（倒计时弹簧锁）"></a>4.5. CountDownLatch（倒计时弹簧锁）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">         CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (CountDownLatchTest.class) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() +</span><br><span class="line">                            <span class="string">&quot;:&quot;</span> +<span class="string">&quot;进入等待&quot;</span> +</span><br><span class="line">                            (latch.getCount() == <span class="number">0</span> ?<span class="string">&quot;&quot;</span>: latch.getCount()));</span><br><span class="line">                    latch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    latch.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> +<span class="string">&quot;结束等待&quot;</span> );</span><br><span class="line">            &#125;,<span class="string">&quot;cousumer&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>执行结果：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cousumer0:进入等待5</span><br><span class="line">cousumer4:进入等待4</span><br><span class="line">cousumer5:进入等待3</span><br><span class="line">cousumer3:进入等待2</span><br><span class="line">cousumer2:进入等待1</span><br><span class="line">cousumer2:结束等待</span><br><span class="line">cousumer4:结束等待</span><br><span class="line">cousumer1:进入等待</span><br><span class="line">cousumer3:结束等待</span><br><span class="line">cousumer0:结束等待</span><br><span class="line">cousumer5:结束等待</span><br><span class="line">cousumer1:结束等待</span><br><span class="line">cousumer8:进入等待</span><br><span class="line">cousumer8:结束等待</span><br><span class="line">cousumer6:进入等待</span><br><span class="line">cousumer6:结束等待</span><br><span class="line">cousumer9:进入等待</span><br><span class="line">cousumer9:结束等待</span><br><span class="line">cousumer7:进入等待</span><br><span class="line">cousumer7:结束等待</span><br></pre></td></tr></table></figure>



<h3 id="4-6-CyclicBarrier-循环阻塞"><a href="#4-6-CyclicBarrier-循环阻塞" class="headerlink" title="4.6. CyclicBarrier(循环阻塞)"></a>4.6. CyclicBarrier(循环阻塞)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">3</span>;</span><br><span class="line">        CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(num);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (CountDownLatchTest.class) &#123;</span><br><span class="line">                    System.out.println(</span><br><span class="line">                            Thread.currentThread().getName() +</span><br><span class="line">                                    <span class="string">&quot;:&quot;</span> + <span class="string">&quot;进入等待&quot;</span> +</span><br><span class="line">                                    cyclicBarrier.getNumberWaiting()</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 计数 + 等待</span></span><br><span class="line">                    cyclicBarrier.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BrokenBarrierException | InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> +<span class="string">&quot;结束等待&quot;</span> );</span><br><span class="line">            &#125;,<span class="string">&quot;cousumer&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>执行结果</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cousumer0:进入等待0</span><br><span class="line">cousumer1:进入等待1</span><br><span class="line">cousumer3:进入等待2</span><br><span class="line">cousumer3:结束等待</span><br><span class="line">cousumer2:进入等待0</span><br><span class="line">cousumer1:结束等待</span><br><span class="line">cousumer0:结束等待</span><br><span class="line">cousumer4:进入等待1</span><br><span class="line">cousumer5:进入等待2</span><br><span class="line">cousumer6:进入等待0</span><br><span class="line">cousumer4:结束等待</span><br><span class="line">cousumer2:结束等待</span><br><span class="line">cousumer5:结束等待</span><br><span class="line">cousumer7:进入等待1</span><br><span class="line">cousumer8:进入等待2</span><br><span class="line">cousumer8:结束等待</span><br><span class="line">cousumer6:结束等待</span><br><span class="line">cousumer7:结束等待</span><br></pre></td></tr></table></figure>



<h3 id="4-7-Semaphore-信号量"><a href="#4-7-Semaphore-信号量" class="headerlink" title="4.7. Semaphore(信号量)"></a>4.7. Semaphore(信号量)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> + <span class="string">&quot;开始任务&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> + <span class="string">&quot;执行结束&quot;</span> );</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;,<span class="string">&quot;cousumer&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cousumer1:开始任务</span><br><span class="line">cousumer2:开始任务</span><br><span class="line">cousumer0:开始任务</span><br><span class="line">cousumer0:执行结束</span><br><span class="line">cousumer1:执行结束</span><br><span class="line">cousumer2:执行结束</span><br><span class="line">cousumer4:开始任务</span><br><span class="line">cousumer5:开始任务</span><br><span class="line">cousumer3:开始任务</span><br><span class="line">cousumer4:执行结束</span><br><span class="line">cousumer3:执行结束</span><br><span class="line">cousumer6:开始任务</span><br><span class="line">cousumer5:执行结束</span><br><span class="line">cousumer7:开始任务</span><br><span class="line">cousumer8:开始任务</span><br><span class="line">cousumer8:执行结束</span><br><span class="line">cousumer7:执行结束</span><br><span class="line">cousumer6:执行结束</span><br><span class="line">cousumer9:开始任务</span><br><span class="line">cousumer9:执行结束</span><br></pre></td></tr></table></figure>

<ul>
<li>只有获取到Semaphore才会开始工作</li>
</ul>
<h3 id="4-8-ReadWriteLock"><a href="#4-8-ReadWriteLock" class="headerlink" title="4.8. ReadWriteLock"></a>4.8. ReadWriteLock</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Mycache mycache = <span class="keyword">new</span> Mycache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; j++)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        mycache.put(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+j,<span class="string">&quot;toy&quot;</span>+j);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="string">&quot;thread&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; j++)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        mycache.get(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+j);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="string">&quot;thread&quot;</span>+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Mycache</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        ReentrantReadWriteLock lock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key,String value)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">            lock.writeLock().lock();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+<span class="string">&quot;开始写入&quot;</span>);</span><br><span class="line">            map.put(key,value);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+<span class="string">&quot;退出写入&quot;</span>);</span><br><span class="line">            lock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">            lock.readLock().lock();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+<span class="string">&quot;开始读取&quot;</span>);</span><br><span class="line">            String value = map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;:&quot;</span>+<span class="string">&quot;退出读取&quot;</span>);</span><br><span class="line">            lock.readLock().unlock();</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">thread0:开始写入</span><br><span class="line">thread0:退出写入</span><br><span class="line">thread0:开始写入</span><br><span class="line">thread0:退出写入</span><br><span class="line">thread2:开始写入</span><br><span class="line">thread2:退出写入</span><br><span class="line">thread2:开始写入</span><br><span class="line">thread2:退出写入</span><br><span class="line">thread1:开始写入</span><br><span class="line">thread1:退出写入</span><br><span class="line">thread1:开始写入</span><br><span class="line">thread1:退出写入</span><br><span class="line">thread0:开始读取</span><br><span class="line">thread0:toy0</span><br><span class="line">thread0:退出读取</span><br><span class="line">thread0:开始读取</span><br><span class="line">thread2:开始读取</span><br><span class="line">thread2:toy0</span><br><span class="line">thread2:退出读取</span><br><span class="line">thread0:toy1</span><br><span class="line">thread0:退出读取</span><br><span class="line">thread1:开始读取</span><br><span class="line">thread1:toy0</span><br><span class="line">thread1:退出读取</span><br><span class="line">thread2:开始读取</span><br><span class="line">thread2:toy1</span><br><span class="line">thread2:退出读取</span><br><span class="line">thread1:开始读取</span><br><span class="line">thread1:toy1</span><br><span class="line">thread1:退出读取</span><br></pre></td></tr></table></figure>

<ul>
<li>所有写线程结束，才会进入读线程。读线程读取时，并没有锁定代码块。</li>
</ul>
<h3 id="4-9-BlockingQueue"><a href="#4-9-BlockingQueue" class="headerlink" title="4.9. BlockingQueue"></a>4.9. BlockingQueue</h3><p><img src="/2021/05/28/java/Java/image-20210604192750304.png" alt="image-20210604192750304"></p>
<h4 id="4-9-1-ArrayBlockingQueue"><a href="#4-9-1-ArrayBlockingQueue" class="headerlink" title="4.9.1. ArrayBlockingQueue"></a>4.9.1. ArrayBlockingQueue</h4><table>
<thead>
<tr>
<th></th>
<th>抛出异常</th>
<th>特殊值</th>
<th>阻塞</th>
<th>超时</th>
</tr>
</thead>
<tbody><tr>
<td>插入</td>
<td>add(e)</td>
<td>offer(e)</td>
<td>put(e)</td>
<td>offer(e, time, unit)</td>
</tr>
<tr>
<td>移除</td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time, unit)</td>
</tr>
<tr>
<td>检查</td>
<td>element()</td>
<td>peek()</td>
<td>不可用</td>
<td>不可用</td>
</tr>
</tbody></table>
<h4 id="4-9-2-SynchronousQueue"><a href="#4-9-2-SynchronousQueue" class="headerlink" title="4.9.2. SynchronousQueue"></a>4.9.2. SynchronousQueue</h4><h3 id="4-10-Executors"><a href="#4-10-Executors" class="headerlink" title="4.10. Executors"></a>4.10. Executors</h3><h4 id="4-10-1-三种创建方式（不采用）"><a href="#4-10-1-三种创建方式（不采用）" class="headerlink" title="4.10.1. 三种创建方式（不采用）"></a>4.10.1. 三种创建方式（不采用）</h4><h4 id="4-10-2-ThreadPoolExecutor-七大参数"><a href="#4-10-2-ThreadPoolExecutor-七大参数" class="headerlink" title="4.10.2. ThreadPoolExecutor 七大参数"></a>4.10.2. ThreadPoolExecutor 七大参数</h4><p><img src="/2021/05/28/java/Java/image-20210717170314604.png" alt="image-20210717170314604"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new &#123;<span class="doctag">@code</span> ThreadPoolExecutor&#125; with the given initial</span></span><br><span class="line"><span class="comment"> * parameters.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> corePoolSize the number of threads to keep in the pool, even</span></span><br><span class="line"><span class="comment"> *        if they are idle, unless &#123;<span class="doctag">@code</span> allowCoreThreadTimeOut&#125; is set</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> maximumPoolSize the maximum number of threads to allow in the</span></span><br><span class="line"><span class="comment"> *        pool</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keepAliveTime when the number of threads is greater than</span></span><br><span class="line"><span class="comment"> *        the core, this is the maximum time that excess idle threads</span></span><br><span class="line"><span class="comment"> *        will wait for new tasks before terminating.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> unit the time unit for the &#123;<span class="doctag">@code</span> keepAliveTime&#125; argument</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> workQueue the queue to use for holding tasks before they are</span></span><br><span class="line"><span class="comment"> *        executed.  This queue will hold only the &#123;<span class="doctag">@code</span> Runnable&#125;</span></span><br><span class="line"><span class="comment"> *        tasks submitted by the &#123;<span class="doctag">@code</span> execute&#125; method.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> threadFactory the factory to use when the executor</span></span><br><span class="line"><span class="comment"> *        creates a new thread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handler the handler to use when execution is blocked</span></span><br><span class="line"><span class="comment"> *        because the thread bounds and queue capacities are reached</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if one of the following holds:&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> keepAliveTime &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt;= 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt; corePoolSize&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> workQueue&#125;</span></span><br><span class="line"><span class="comment"> *         or &#123;<span class="doctag">@code</span> threadFactory&#125; or &#123;<span class="doctag">@code</span> handler&#125; is null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="params"><span class="function">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="params"><span class="function">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="params"><span class="function">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="params"><span class="function">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">                          </span><br><span class="line">                          &#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>cpu密集型</li>
<li>IO密集型</li>
</ul>
<h3 id="4-11-四大函数式接口"><a href="#4-11-四大函数式接口" class="headerlink" title="4.11. 四大函数式接口"></a>4.11. 四大函数式接口</h3><h3 id="4-12-Stream-流式计算"><a href="#4-12-Stream-流式计算" class="headerlink" title="4.12. Stream 流式计算"></a>4.12. Stream 流式计算</h3><h3 id="4-13-ForkJoin"><a href="#4-13-ForkJoin" class="headerlink" title="4.13. ForkJoin"></a>4.13. ForkJoin</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1252599548343744/1306581226487842">ForkJoin</a></p>
</blockquote>
<h3 id="4-14-异步回调"><a href="#4-14-异步回调" class="headerlink" title="4.14. 异步回调"></a>4.14. 异步回调</h3><p><img src="/2021/05/28/java/Java/image-20210717171601990.png" alt="image-20210717171601990"></p>
<h3 id="4-15-JMM"><a href="#4-15-JMM" class="headerlink" title="4.15. JMM"></a>4.15. JMM</h3><p><img src="/2021/05/28/java/Java/d866f75118d947c2b3c4bc4a340c3d38~tplv-k3u1fbpfcp-watermark.image" alt="img"></p>
<p><strong>内存屏障（Memory Barrier）又称内存栅栏，是一个CPU指令，它的作用有两个：</strong></p>
<ul>
<li>保证特定操作的顺序</li>
<li>保证某些变量的内存可见性（利用该特性实现volatile的内存可见性）</li>
</ul>
<h3 id="4-16-volatile"><a href="#4-16-volatile" class="headerlink" title="4.16. volatile"></a>4.16. volatile</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38862628/article/details/112169326">JMM角度详解Volatile</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012723673/article/details/80682208">Java volatile关键字</a></p>
</blockquote>
<p>volatile 是java虚拟机提供的轻量级的同步机制</p>
<ol>
<li>保证可见性</li>
<li>不保证原子性</li>
</ol>
<ul>
<li>原子类</li>
</ul>
<ol start="3">
<li>禁止指令重排</li>
</ol>
<h3 id="4-17-单例模式"><a href="#4-17-单例模式" class="headerlink" title="4.17. 单例模式"></a>4.17. 单例模式</h3><ul>
<li>DCL懒汉式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>枚举</li>
</ul>
<h3 id="4-18-CAS"><a href="#4-18-CAS" class="headerlink" title="4.18. CAS"></a>4.18. CAS</h3><ul>
<li>ABA 问题</li>
<li>AtomicInteger  </li>
<li>AtomicStampedReference</li>
</ul>
<h3 id="4-19-各种锁"><a href="#4-19-各种锁" class="headerlink" title="4.19. 各种锁"></a>4.19. 各种锁</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://tech.meituan.com/2018/11/15/java-lock.html">不可不说的Java“锁”事</a></p>
</blockquote>
<h4 id="4-19-1-公平锁、非公平锁"><a href="#4-19-1-公平锁、非公平锁" class="headerlink" title="4.19.1. 公平锁、非公平锁"></a>4.19.1. 公平锁、非公平锁</h4><h4 id="4-19-2-可重入锁"><a href="#4-19-2-可重入锁" class="headerlink" title="4.19.2. 可重入锁"></a>4.19.2. 可重入锁</h4><h4 id="4-19-3-自旋锁"><a href="#4-19-3-自旋锁" class="headerlink" title="4.19.3. 自旋锁"></a>4.19.3. 自旋锁</h4><h4 id="4-19-4-死锁"><a href="#4-19-4-死锁" class="headerlink" title="4.19.4. 死锁"></a>4.19.4. 死锁</h4><ul>
<li>死锁排查</li>
</ul>
<p>程序员面试宝典4.27版</p>
<h2 id="5-JVM"><a href="#5-JVM" class="headerlink" title="5. JVM"></a>5. JVM</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.processon.com/view/5ed19b151e085306e3638b04#map">知识架构图</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.processon.com/view/5f93d20763768906e68676d4">JVM内存图</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/TomAndersen/article/details/107147344">字符串常量池</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freesion.com/article/8181984190/">动态链接</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45076180/article/details/108441940">订单秒杀jvm调优案例</a></p>
<p><a target="_blank" rel="noopener" href="https://tech.meituan.com/tags/jvm.html">美团JVM相关文档</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 字面量测试</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: yql</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/6/8 18:43</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiteralTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String s = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> anInt = <span class="number">25</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> bnInt = <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer cnInt = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> dnInt = <span class="number">70</span>;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        anInt = <span class="number">90</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看编译后类信息</span></span><br><span class="line">javap -verbose LiteralTest.class</span><br></pre></td></tr></table></figure>



<h2 id="6-Java8"><a href="#6-Java8" class="headerlink" title="6. Java8"></a>6. Java8</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liuxiaozhi23/p/10880147.html">java8特性</a></p>
</blockquote>
<h3 id="6-1-函数式接口"><a href="#6-1-函数式接口" class="headerlink" title="6.1. 函数式接口"></a>6.1. 函数式接口</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-functional-interfaces.html">函数式接口</a></p>
</blockquote>
<ul>
<li>定义：任何接口，如果只包含唯一一个抽象方法，那么它就是函数式接口 </li>
<li>可以用lamada表达式代替匿名内部类来实现</li>
</ul>
<h4 id="6-1-1-Predicates"><a href="#6-1-1-Predicates" class="headerlink" title="6.1.1 Predicates"></a>6.1.1 Predicates</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-1-2-Functions"><a href="#6-1-2-Functions" class="headerlink" title="6.1.2 Functions"></a>6.1.2 Functions</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;	</span><br><span class="line">	<span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-1-3-Suppliers"><a href="#6-1-3-Suppliers" class="headerlink" title="6.1.3 Suppliers"></a>6.1.3 Suppliers</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-1-4-Consumers"><a href="#6-1-4-Consumers" class="headerlink" title="6.1.4 Consumers"></a>6.1.4 Consumers</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-2-Lamada表达式"><a href="#6-2-Lamada表达式" class="headerlink" title="6.2. Lamada表达式"></a>6.2. Lamada表达式</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-lambda-expressions.html">Lambda 表达式</a></p>
</blockquote>
<h3 id="6-3-方法引用"><a href="#6-3-方法引用" class="headerlink" title="6.3. 方法引用"></a>6.3. 方法引用</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-method-references.html">方法引用</a></p>
</blockquote>
<h3 id="6-4-Stream"><a href="#6-4-Stream" class="headerlink" title="6.4. Stream"></a>6.4. Stream</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-streams.html">Stream</a></p>
</blockquote>
<h3 id="6-5-默认方法"><a href="#6-5-默认方法" class="headerlink" title="6.5. 默认方法"></a>6.5. 默认方法</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-default-methods.html">默认方法</a></p>
</blockquote>
<h3 id="6-6-Optional-类"><a href="#6-6-Optional-类" class="headerlink" title="6.6. Optional 类"></a>6.6. Optional 类</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-optional-class.html">Optional 类</a></p>
</blockquote>
<h3 id="6-7-日期时间"><a href="#6-7-日期时间" class="headerlink" title="6.7. 日期时间"></a>6.7. 日期时间</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-datetime-api.html">新的日期时间 API</a></p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/juc/" rel="tag">juc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jvm/" rel="tag">jvm</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2021/05/29/java/netty/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            netty
          
        </div>
      </a>
    
    
  </nav>

   
 
   
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">


<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: '58e345e66c3895205e5e',
    clientSecret: 'ad9d1739ef39205c50826acca580c9351244bf9c',
    repo: 'yangqinglei26.github.io',
    owner: 'yangqinglei26',
    admin: ['yangqinglei26'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: false,  // Facebook-like distraction free mode
    pagerDirection: 'last'
  })

  gitalk.render('gitalk-container')
</script>

     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2022
        <i class="ri-heart-fill heart_icon"></i> fordreams1314
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/face.jpg" alt="fordreams1314个人博客"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/java">JAVA</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E7%94%9F%E6%B4%BB">生活</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E7%AE%A1%E7%90%86">管理</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
  </div>
</body>

</html>